# ORA Discord Bot - Ultimate Edition üåå
### *The Next-Generation AI Orchestrator for RTX 5090*

<div align="center">

![ORA Banner](https://raw.githubusercontent.com/YoneRai12/ORA/main/docs/banner.png)

[![Discord](https://img.shields.io/badge/Discord-Join-7289DA?style=for-the-badge&logo=discord)](https://discord.gg/YoneRai12)
[![Python](https://img.shields.io/badge/Python-3.11-3776AB?style=for-the-badge&logo=python)](https://www.python.org/)
[![Structure](https://img.shields.io/badge/Architecture-Hybrid%20Satellite-FF0055?style=for-the-badge)](https://github.com/vllm-project/vllm)
[![GPU](https://img.shields.io/badge/GPU-RTX%205090%20Optimized-76B900?style=for-the-badge&logo=nvidia)](https://www.nvidia.com/)

<div align="center">

[![English](https://img.shields.io/badge/Language-English-blue?style=for-the-badge)](README.md)
[![Japanese](https://img.shields.io/badge/Ë®ÄË™û-Êó•Êú¨Ë™û-red?style=for-the-badge)](README_JP.md)

</div>

</div>

---

## üöÄ Overview
ORA is a fully autonomous AI Operating System running locally on your hardware. It integrates the world's most advanced open-source models into a seamless, unified experience inside Discord.

---

## ‚ú® Why ORA? (Key Benefits)

| Feature | Details |
| :--- | :--- |
| **üí∞ Zero Monthly Fees** | Unlike ChatGPT Plus ($20/mo) or Midjourney ($10/mo), ORA runs **100% locally**. You own the AI. |
| **üîí Complete Privacy** | No data leaves your PC. Your chats, images, and voice are processed on your **RTX 5090**. |
| **‚ö° High Performance** | Optimized for **RTX 5090 (32GB VRAM)**, ensuring maximum speed and quality. |

---

## üß† Universal Brain (v3.0)
A Hybrid System merging "Cloud Intelligence" with "Local Privacy".

### üß† Two Operation Modes
1.  **Smart Mode (Recommended)**: 
    *   *Active only upon User Consent.*
    *   Leverages **GPT-5 Series (OpenAI)** and **Gemini 2.0 (Google)** for complex code generation and advanced vision.
    *   Shared Traffic (Free): 250k ~ 2.5M tokens/day available via OpenAI Shared Lane.
2.  **Private Mode (Default)**:
    *   *Active if consent is denied or ignored.*
    *   **100% Local**. No data leaves your machine.
    *   Maximizes your **RTX 5090** capability locally.

---

## üåü Technical Highlights

*   **üß† Dual-Architecture (Brain + Voice)**: 
    *   **Main Brain**: `Ministral-3-14B` via vLLM (Logic, Tools, Vision).
    *   **Voice Engine**: `T5Gemma-TTS` via Services (Voice Cloning, Speech).
*   **üó£Ô∏è Doppelganger Mode**: Can clone and speak with **YOUR voice** (Zero-Shot Cloning).
*   **üëÅÔ∏è True Vision (Native)**: Can see video and images directly through the Main Brain.
*   **üé® Hollywood-Grade Art**: Generates 4K images using **FLUX.2** (State of the Art).
*   **üéÆ Zero-Latency Gaming**: Automatically detects games (Apex/Valorant) and shrinks VRAM usage to save FPS.

---

## üÜï Agentic Stability & Self-Evolution (v4.1 - 2026/01/05)

### ü§ñ High-End Model Restoration (Codex stabilization)
Stabilized agentic capabilities for the Shared Traffic series.
*   **gpt-5.1-codex Support**: Correctly routes to the `/responses` endpoint and handles "Tool Call" parsing (flattening & mapping).
*   **Auto-Parameter Filtering**: Automatically removes incompatible parameters like temperature for O1 and Codex models.

### üß† Enhanced Context Awareness
*   **Channel History Fallback**: ORA now automatically fetches the last 15 messages from the channel if no direct reply is found. No more "forgetting" the previous context!

### üõ†Ô∏è Self-Evolution & Reliability
*   **Healer 2.0**: Interactive UI to apply or dismiss AI-suggested code fixes safely.
*   **Log Forwarder**: Real-time log streaming to a dedicated Discord channel for remote monitoring.
*   **Pre-flight Health Checks**: Integrated `health_inspector` to verify system integrity before applying changes.

---

## üÜï The Mac Expansion (v4.0 - 2025/12/30)

### üçé ORA Mac Migration Support
**FULL Support for Apple Silicon (M1/M2/M3/M4).**
*   **Unified Logic**: Run ORA's Brain on your Windows/Mac.
*   **Remote Dev Ready**: Includes `MIGRATION_GUIDE.md` for seamless VS Code Remote SSH setups.
*   **One-Click Setup**: Dedicated `Double_Click_To_Start.command` for Mac users.

### üìê Automatic Math Rendering
Native LaTeX/TeX support for beautiful mathematical expressions.
*   **Auto-Detect**: ORA automatically recognizes math in responses.
*   **Visual Rendering**: Converts complex equations (integral, matrix, etc.) into transparent PNGs instantly.

---

## üìä Dashboard Refresh (v3.9 - 2025/12/26)

Implemented a new dashboard UI for at-a-glance system status.
*   **Active Processing**: Real-time Cyan highlighting for the user currently being processed (Top-Left).
*   **Token Tracking**: Accurate token usage tracking for all models including GPT-5.1.
*   **Privacy Safe Mode**: Hides personal information for screenshots.

---

## üöÄ The Commander's Intel (Phase 21 Upgrade)
*December 2025 Update: The Final Piece*

ORA is currently evolving to encompass the **9 Pillars of Singularity**:

1.  **üß† Reflex Brain**: Nemotron 3 Nano (381 tokens/s) for instant conversational reflexes.
2.  **üëÅÔ∏è God's View**: Real-time Desktop Monitoring via `mss` + Vision API.
3.  **üé® Photoshop Core**: Image Layer Decomposition (`/layer`) via Qwen-Image-Layered.
4.  **üí† 3D Alchemy**: Generating Minecraft items from images via **TRELLIS.2**.
5.  **‚ö° FunctionGemma**: Dedicated 270M Router for ultra-low latency tool selection.
6.  **üåê Research Agent**: BU-30B Browser Agent for autonomous web navigation.
7.  **üé≠ Infinite Personas**: ELYZA-style LoRA switching (Maid, Engineer, Commander).
8.  **üíÖ Premium UI**: Google Sans Flex integration for a state-of-the-art dashboard.
9.  **üè° Jarvis Control**: Voice-to-IoT control for total room automation.

---

## üí° Practical Use Cases

| Scenario | How ORA Helps |
| :--- | :--- |
| **ü§ñ Gaming Companion** | "Hey ORA, look at my screen. Where is the enemy?" (Vision) |
| **üé® Creative Studio** | "Generate a Youtube thumbnail for Minecraft, anime style." (Image Gen) |
| **üëØ Doppelganger** | "Clone my voice from this audio file." (Voice Cloning) |
| **üìö Homework Helper** | "Solve this calculus problem step-by-step." (Reasoning Model) |
| **üéôÔ∏è Vtuber / Stream** | Can act as a fully voiced co-host that reads chat and responds. |
| **üîç Research** | "Search the web for RTX 5090 benchmarks and summarize." (Tools) |

---

## üèóÔ∏è System Architecture & Components

### üîÑ Logic Flow (Visualized)

The **Omni-Router** intelligently directs traffic to the best possible engine based on complexity and cost.

```mermaid
%%{init: { 'theme': 'dark' }}%%
graph TD
    Input[Input Request] --> Router{Smart Router}
    
    %% Local Path
    Router -->|Privacy / Speed| Local[üè† Local Brain]
    Local --> Ministral[Ministral-3-14B]
    Local --> Qwen[Qwen-VL 32B]
    
    %% Cloud Path
    Router -->|Coding / Complexity| Cloud[‚òÅÔ∏è Cloud Brain]
    Cloud --> GPT[OpenAI GPT-5.1]
    Cloud --> Gemini[Gemini 2.0 Flash]

    %% Tools & Actions
    Local --> Tools[üõ†Ô∏è Tools]
    Cloud --> Tools
    
    Tools --> Image[üé® Flux.1 Generate]
    Tools --> Vision[üëÅÔ∏è Screen Analyze]
    Tools --> System[üíª PC Control (Win/Mac)]

    %% Output
    Tools --> Response
    GPT --> Response
    Ministral --> Response[Final Response]
    
    style Router fill:#ff0055,stroke:#fff,stroke-width:2px
    style Local fill:#00aaff,stroke:#fff
    style Cloud fill:#aa00ff,stroke:#fff
    style Flatten fill:#00ff00,stroke:#000
```

This system uses an **Automatic Semantic Router** to dynamically assign tasks to the most appropriate AI model.

| Feature | Model / Engine | Provider | Status |
| :--- | :--- | :--- | :--- |
| **LLM (Brain)** | Ministral-3-14B | vLLM (Local) | üü¢ Active |
| **Vision (Eyes)** | Qwen3-VL (Native) | vLLM (Local) | üü¢ Active |
| **Image Gen** | Flux.1-dev (FP8) | ComfyUI | üü¢ Active |
| **Video Rec** | SAM 2 (Segment Anything) | Meta (Facebook) | üü° Loaded |
| **TTS (Std)** | VOICEVOX | Docker / Local | üü¢ Active |
| **TTS (Real)** | Aratako_T5Gemma-TTS | Transformers | üü¢ Active (Port 8002) |

---

## üíª Installation & Usage

### 1. Model Setup (First Time)
Run the downloader to fetch the Voice Engine weights (~10GB):
```bash
python download_triad_models.py
```

### 2. Launching ORA
*   **Start Services**: Double-click `start_services.bat`.
    *   Launches Voice Engine (T5Gemma) on Port 8002.
*   **Start Launcher**: Right-Click Desktop -> "Start ORA Bot".
    *   Launches vLLM (Brain) and ComfyUI (Image).

### Manual Modes
If launching via `start_vllm.bat`:
*   `[1] Normal`: Full power (Mistral/Qwen 30B).
*   `[2] Thinking`: Forces Reasoning model.
*   `[3] Gaming`: Low-VRAM mode (7B Model).

### ‚öôÔ∏è Configuration
You can tweak ORA's behavior in `src/config.py` or `.env`.

| Variable | Description | Default |
| :--- | :--- | :--- |
| `ORA_DEV_GUILD_ID` | Server ID for Slash Commands (Global if empty) | None |
| `SD_API_URL` | URL for ComfyUI/SD Backend | `http://localhost:8188` |
| `LLM_API_URL` | URL for vLLM Backend | `http://localhost:8001/v1` |
| `VOICE_ENGINE_URL` | URL for T5Gemma TTS | `http://localhost:8002` |

---

## üìö Detailed Command List

### üé® Image Generation
`/imagine [prompt] [style] [resolution]`
*   **Prompt**: "A cyberpunk city at night".
*   **Style**: "Anime", "Photo", "Oil Painting" (Auto-detected if omitted).
*   **Resolution**: FHD, 4K, Ultrawide.
*   *Note: ORA uses FLUX.2, which follows prompts exactly.*

### üëÅÔ∏è Vision Analysis
`/analyze [image/video]`
*   Upload a file and ask "What is happening here?".
*   Use "Solve this" for math homework.

### ÔøΩÔ∏è Voice & Cloning
*   `/join` / `/leave`: Auto-Read chat messages via TTS.
*   `/doppelganger [audio]`: Registers your voice. ORA will start speaking with YOUR voice.
*   `/listen`: Talk to ORA directly. She hears you!

### üîß Tools & Utilities
*   `/search`: Google Search.
*   `/timer`: Set alarms.
*   `/system`: VRAM/Temp monitor.
*   `/shiritori`: Play games.

---

## üß† RTX 5090 AI Training System
*This repository now includes a specialized module for fine-tuning ORA's brain (Mistral-3-14B-Instruct) natively on Windows using the RTX 5090.*

### üéØ Phase 18: Tool Mastery (LoRA Curriculum)
We are fine-tuning the model to master specific Discord operations without prompting:
1.  **Identity**: Recall "I am ORA, created by YoneRai12."
2.  **Tool Use**: Precisely outputting JSON for `generate_image`, `web_search`, `doppelganger`.
3.  **Moderation**: Precision use of `ban_user`, `kick_user`.

### ‚öôÔ∏è Technical Specs (Blackwell Optimized)
*   **Model**: `mistralai/Ministral-3-14B-Instruct-2512`
*   **Method**: QLoRA (4-bit NF4 Quantization)
*   **Precision**: BFloat16 (Native Mixed Precision for RTX 5090)
*   **Stack**: Pure PyTorch Nightly (CUDA 12.8) + BitsAndBytes Windows

### üöÄ How to Train
1.  **Generate Data**:
    ```bash
    python src/training/prepare_tool_data.py
    ```
    *(Generates 1,000 synthetic User -> Thought -> Tool samples)*

2.  **Start Training**:
    ```bash
    cd RTX5090-DebugSystem-main
    start_training.bat
    ```
    *(Auto-monitors VRAM and Loss convergence)*

---

## ‚ùì Troubleshooting
*   **"System Swapping / Laggy"**: 
    *   *Cause*: vLLM default VRAM reservation (90%) leaves no room for Windows.
    *   *Fix*: Launcher sets `gpu-memory-utilization` to 0.60 (60%). Restart the bot.
*   **"Bot starts but vLLM stops"**:
    *   *Cause*: Port conflict. Bot tries to start its own vLLM.
    *   *Fix*: Fixed in ResourceManager (Startup Adoption). Restart the bot.
*   **"Image Generation Failed"**:
    *   *Cause*: ComfyUI not running.
    *   *Fix*: Use the "Start ORA Bot" launcher (it starts Comfy automatically).

---

<div align="center">

**Developed by YoneRai12**
*Powered by the Bleeding Edge of AI*
*The Future is Local.*

</div>
